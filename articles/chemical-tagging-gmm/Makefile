# Note that Travis CI uses tectonic, which might be important to know when debugging
# any errors between local and remote builds.
#
LATEX       = openout_any=a pdflatex
all: ms.pdf

vc.tex: ../../.git/logs/HEAD
	echo "%%% This file is generated by the Makefile." > vc.tex
	echo '\newcommand{\giturl}{\url{%' >> vc.tex
	git config --get remote.origin.url | sed "s/\.git$$//" | sed "s/^ssh:\/\///g" | sed "s/^git\@github\.com:/https:\/\/www\.github\.com\//" >> vc.tex
	echo '}}' >> vc.tex
	git log -1 --date=short --format="format:\\newcommand{\\githash}{%h}\\newcommand{\\gitdate}{%ad}\\newcommand{\\gitauthor}{%an}" >> vc.tex
	# Safely replace newline character if it exists
	cat vc.tex | sed "s/^ewcommand/\\\newcommand/" > vc_safe.tex
	mv vc_safe.tex vc.tex

%.pdf: %.tex vc.tex
	${LATEX} $<
	${LATEX} $<
	${LATEX} $<
